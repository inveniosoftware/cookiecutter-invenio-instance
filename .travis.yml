# -*- coding: utf-8 -*-
#
# This file is part of Invenio.
# Copyright (C) 2015-2018 CERN.
#
# Invenio is free software; you can redistribute it and/or modify it
# under the terms of the MIT License; see LICENSE file for more details.

sudo: false

notifications:
  email: false

language: python

matrix:
  fast_finish: true

cache:
  - pip

services:
  - docker

addons:
  apt:
    packages:
    - docker-ce # Use latest available Docker-CE from official repo

env:
  global:
    # Latest available version of Docker-Compose at the time of commit.
    # To download latest available version, one needs to do some (JSON) parsing
    # as Github doesn't provide an easy way to download the latest release.
    - DOCKER_COMPOSE_VERSION=1.21.1
    - E2E="no"
  matrix:
    - COOKIECUTTER_DATABASE=postgresql COOKIECUTTER_ELASTICSEARCH=elasticsearch5 ES_VERSION=5.6.4
    - COOKIECUTTER_DATABASE=mysql COOKIECUTTER_ELASTICSEARCH=elasticsearch5 ES_VERSION=5.6.4
    - COOKIECUTTER_DATABASE=postgresql COOKIECUTTER_ELASTICSEARCH=elasticsearch6 ES_VERSION=6.2.2
    - COOKIECUTTER_DATABASE=mysql COOKIECUTTER_ELASTICSEARCH=elasticsearch6 ES_VERSION=6.2.2

python:
  - "3.5"

before_install:
  # Stop default PostgreSQL instance
  - sudo /etc/init.d/postgresql stop
  # Install latest docker-compose, configured by DOCKER_COMPOSE_VERSION env var.
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - "nvm install 6; nvm use 6"
  - "travis_retry pip install --upgrade pip setuptools py"
  - "travis_retry pip install cookiecutter twine wheel coveralls requirements-builder sphinx"

script:
  - "./run-tests.sh"
